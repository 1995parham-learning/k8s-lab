---
nats:
  global:
    labels:
      app: jetstream
      team: main
  natsBox:
    enabled: false
  config:
    merge:
      00$include: auth.conf
      accounts:
        iraq:
          jetstream: enabled
          users:
            - { user: user, password: password }
            - { user: default, password: default }
        lebanon:
          jetstream: enabled
          users:
            - { user: lb-user, password: user }
            - { user: lb-default, password: default }
        "$SYS":
          users:
            - { user: << $ADMIN_USERNAME >>, password: << $ADMIN_PASSWORD >> }
      system_account: "$SYS"
    cluster:
      noAdvertise: true
      enabled: true
      replicas: 5
    gateway:
      enabled: false
    leafnodes:
      enabled: false
    jetstream:
      enabled: true
      memoryStore:
        enabled: true
        maxSize: 150Mi
      fileStore:
        maxSize: 4Gi
        enabled: true
        storageDirectory: /data
        pvc:
          name: nats-gp3
          enabled: true
          size: 10Gi
  container:
    env:
      ADMIN_USERNAME: "admin"
      ADMIN_PASSWORD: "password"
    merge:
      resources:
        requests:
          cpu: 100m
          memory: 500Mi
          ephemeral-storage: 1Gi
        limits:
          cpu: 200m
          memory: 750Mi
          ephemeral-storage: 1Gi
  promExporter:
    enabled: false
    podMonitor:
      enabled: true
  configMap:
    merge:
      data:
        auth.conf: |-
          authorization {
          }
          no_auth_user: "default"
  extraResources:
    - apiVersion: v1
      kind: Service
      metadata:
        name:
          $tplYaml: >
            {{ include "nats.fullname" $ }}-lb
        labels:
          $tplYaml: |
            {{ include "nats.labels" $ }}
      spec:
        type: LoadBalancer
        selector:
          $tplYaml: |
            {{ include "nats.selectorLabels" $ }}
        ports:
          - name: nats
            port: 4222
            targetPort: nats
            protocol: TCP
