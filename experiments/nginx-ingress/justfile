manifest_url := "https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml"

# Install NGINX Ingress
install:
    @echo "Applying NGINX Ingress manifest..."

    kubectl apply -f {{ manifest_url }}

    @echo "⏳ Waiting for Ingress controller pod to be ready..."

    while [ -z "$(kubectl get pod -n ingress-nginx --selector=app.kubernetes.io/component=controller -o name)" ]; do echo "Waiting for nginx controller pods to be created..." && sleep 2; done

    kubectl wait --namespace ingress-nginx \
      --for=condition=ready pod \
      --selector=app.kubernetes.io/component=controller \
      --timeout=120s

    @echo "✅ NGINX Ingress installed successfully."

# Remove NGINX Ingress
remove:
    @echo "Deleting NGINX Ingress manifest..."

    kubectl delete -f {{ manifest_url }} --ignore-not-found=true

    @echo "✅ NGINX Ingress removed."
